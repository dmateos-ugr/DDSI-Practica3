https://www.quora.com/What-is-the-easiest-way-to-store-files-in-the-Oracle-database

## DISPARADORES
1. rs1. al quitar una tupla de la tabla Autor, comprobar que no tenga canciones subidas. en ese caso, error. MIGUEL
2. rs2 y rs3. al crear una tupla en la tabla Firma, comprobar que el autor de la canción tenga más de 16 años. DANIEL.
3. rs4: problema del futuro
4. rs5: al modificar un contrato, comprobar que la fecha sea mayor o igual que la que ya hay. en caso contrario, error. MIGUEL.
5. rs6: al modificar un contrato, comprobar que la fecha sea mayor o igual que la sysdate. en caso contrario, error. MIGUEL.
6. rs7 y rs8: al crear una tupla en la tabla Firma, comprobar que todos los autores de las canciones son el mismo (por el diseño, el autor del contrato es este autor). DAVID M.
7. rs9: al añadir una tupla a cancion_vendida, comprobar que está asociada a un contrato de autor. DAVID C.
8. rs10: al añadir una tupla a cancion_promocionada, comprobar que está asociada a un contrato de autor. DAVID C.
9. adicional1: al insertar una tupla en cancion_sube, la inserta tambien en cancion_activa. DANIEL.

## MENU LOGIN DAVID M.
1. logearse: pide nickname y contraseña, si están bien pasa a menu principal
2. registrarse: registra un usuario y vuelve a menu login

## MENU PRINCIPAL
1. mi cuenta: pasa a menu de cuenta
2. mis canciones (si es autor)
3. mis contratos (si es autor)
4. mis playlists
5. explorar

# MENU CUENTA MIGUEL.
visualizar perfil del usuario
1. añadir amigo: pide nickname y añade
2. eliminar amigo: pide nickname y elimina
3. modificar tipo de usuario
4. darse de baja

# MENU MIS CANCIONES DANIEL.
lista las canciones del usuario
1. subir canción
2. eliminar canción

# MENU MIS CONTRATOS DAVID C.
lista contratos del usuario
1. crear contrato de autor
2. crear contrato de promoción
3. renovar contrato

# MENU MIS PLAYLISTS DAVID M.
lista las playlists del usuario
1. crear playlist
2. eliminar playlist
3. modificar playlist: pide id de playlist y pasa a menú modificar playlist

# MENU MODIFICAR PLAYLIST MIGUEL.
lista canciones de la playlist
1. añadir canción
2. quitar canción

# MENU EXPLORAR DANIEL.
1. listar canciones
2. listar playlists
3. acceder a canción: pide id de canción y pasa a MENU CANCIÓN
4. listar canciones de playlist
3. visualizar perfil

# MENU CANCIÓN DAVID C.
mostrar información de canción
1. reproducir
2. añadir a playlist
3. evaluar
4. si es autor igual ponemos más cosas



## Script creación tablas

~~~mysql
CREATE TABLE usuario(
    nick VARCHAR2(20) PRIMARY KEY,
    nombre VARCHAR2(20),
    apellidos VARCHAR2(20),
    correo VARCHAR2(40) UNIQUE,
    contrasena VARCHAR2(32),
    fecha_nacimiento DATE
);

CREATE TABLE autor(
    nick VARCHAR2(20) PRIMARY KEY REFERENCES usuario(nick)
);

CREATE TABLE usuario_no_activo(
    nick VARCHAR2(20) PRIMARY KEY REFERENCES usuario(nick)
);

CREATE TABLE amistarse(
    nick1 VARCHAR2(20) REFERENCES usuario(nick),
    nick2 VARCHAR2(20) REFERENCES usuario(nick),
    CONSTRAINT clave_primaria_amistarse PRIMARY KEY (nick1, nick2)
);

CREATE TABLE archivo(
    id_archivo INTEGER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    archivo BLOB,
    duracion INTEGER
);

CREATE TABLE cancion_sube(
    id_cancion INTEGER GENERATED BY DEFAULT ON NULL AS IDENTITY  PRIMARY KEY,
    titulo VARCHAR2(30),
    archivo INTEGER REFERENCES archivo(id_archivo),
    fecha DATE,
    etiqueta VARCHAR(30),
    nick VARCHAR(30) REFERENCES usuario(nick)
);

CREATE TABLE cancion_activa(
    id_cancion INTEGER PRIMARY KEY REFERENCES cancion_sube(id_cancion)
);

CREATE TABLE cancion_promocionada(
    id_cancion INTEGER PRIMARY KEY REFERENCES cancion_activa(id_cancion)
);

CREATE TABLE cancion_vendida(
    id_cancion INTEGER PRIMARY KEY REFERENCES cancion_activa(id_cancion)
);

CREATE TABLE contrato(
    id_contrato INTEGER  GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    cuenta_bancaria VARCHAR2(30),
    cantidad_pagada NUMBER(5,2),
    fecha_caducidad DATE
);

CREATE TABLE contrato_autor(
    id_contrato INTEGER PRIMARY KEY REFERENCES contrato(id_contrato)
);

CREATE TABLE contrato_promocion(
    id_contrato INTEGER PRIMARY KEY REFERENCES contrato(id_contrato),
    fecha_caducidad DATE
);

CREATE TABLE firma(
    id_contrato INTEGER  REFERENCES contrato(id_contrato),
    id_cancion INTEGER REFERENCES cancion_activa(id_cancion),
    CONSTRAINT clave_primaria_firma PRIMARY KEY(id_contrato, id_cancion)
);

CREATE TABLE playlists_crea(
    id_playlist INTEGER  GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    nombre VARCHAR2(30),
    fecha_creacion DATE,
    nick REFERENCES usuario(nick)
);

CREATE TABLE playlist_publica(
    id_playlist INTEGER PRIMARY KEY REFERENCES playlists_crea(id_playlist)
);

CREATE TABLE contiene(
    id_cancion REFERENCES cancion_sube(id_cancion),
    id_playlist REFERENCES playlists_crea(id_playlist),
    CONSTRAINT clave_primaria_contiene PRIMARY KEY (id_cancion, id_playlist)
)
~~~



## Script borrado tablas

~~~mysql
DROP TABLE CANCION_PROMOCIONADA;
DROP TABLE CANCION_VENDIDA;
DROP TABLE CANCION_ACTIVA;
DROP TABLE FIRMA;
DROP TABLE CONTIENE;
DROP TABLE CANCION_SUBE;
DROP TABLE ARCHIVO;
DROP TABLE CONTRATO_AUTOR;
DROP TABLE CONTRATO_PROMOCION;
DROP TABLE CONTRATO;
DROP TABLE PLAYLIST_PUBLICA;
DROP TABLE PLAYLISTS_CREA;
DROP TABLE AUTOR;
DROP TABLE AMISTARSE;
DROP TABLE USUARIO_NO_ACTIVO;
DROP TABLE USUARIO;
~~~



## Procedimientos

~~~plsql
CREATE OR REPLACE PROCEDURE SUBIR_CANCION 
(
  TITULO IN VARCHAR2 
, FICHERO IN BLOB 
, DURACION IN INTEGER
, FECHA IN DATE 
, ETIQUETA IN VARCHAR2 
, NICK IN VARCHAR2 
) AS
ID_FICHERO_SUBIDO ARCHIVO.ID_ARCHIVO%TYPE;
BEGIN
    INSERT INTO ARCHIVO VALUES (NULL, FICHERO, DURACION)
    RETURNING ID_ARCHIVO INTO ID_FICHERO_SUBIDO;
    
    INSERT INTO CANCION_SUBE VALUES(
        NULL, 
        TITULO, 
        ID_FICHERO_SUBIDO, 
        FECHA, 
        ETIQUETA, 
        NICK
    );
  NULL;
END SUBIR_CANCION;
~~~

